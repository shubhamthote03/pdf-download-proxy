<!DOCTYPE html>
<html>
<head>
  <title>PDF Download Proxy</title>
</head>
<body>
  <h2>Click to download PDF</h2>
  <button onclick="downloadPDF()">Download PDF</button>

  <script>
    async function downloadPDF() {
      const cust_name = "Customer1";
      const base64 = "data:application/pdf;base64,JVBERi0xLjUKJYCBgoMKMSAwIG9iago8PC9GaWx0ZXIvRmxhdGVEZWNvZGUvRmlyc3QgMTQxL04gMjAvTGVuZ3=="; // shorten for test

      try {
        const response = await fetch("https://powerbicrm-prd.azurewebsites.net/api/DisplayPDFPost", {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({
            cust_name,
            base64
          })
        });

        const contentType = response.headers.get("Content-Type");

        if (!response.ok) {
          const errorText = await response.text();
          console.error("Server response:", errorText);
          document.querySelector("p").innerText = `Bad Request (${response.status}): ${errorText}`;
          return;
        }

        if (contentType.includes("application/pdf")) {
          const blob = await response.blob();
          const url = URL.createObjectURL(blob);
          const link = document.createElement("a");
          link.href = url;
          link.download = `${cust_name}.pdf`;
          link.click();
          URL.revokeObjectURL(url);
        } else {
          const text = await response.text();
          console.error("Not a PDF:", text);
        }
      } catch (err) {
        console.error("Fetch error:", err);
        document.querySelector("p").innerText = "Fetch error: " + err.message;
      }
    }
  </script>

  <p style="color:red;"></p>
</body>
</html>
